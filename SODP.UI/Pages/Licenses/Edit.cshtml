@page

@using SODP.UI.Pages.Licenses.ViewModels;

@model EditModel
@{
}

<br />

<div class="container row p-0 m-0">
    <div class="col">
        <h2 class="text-info">Edycja uprawnienia</h2>
    </div>
</div>

<br />

<div class="container">
    <div class="border justify-content-end col-md-7" style="padding:30px">
        <form asp-page-handler="EditLicense" method="post">
            <input name="IsValidate" type="hidden" value="@ViewData.ModelState.IsValid.ToString()" />
            <input type="hidden" asp-for="License.Id" />
            <input type="hidden" asp-for="License.DesignerId" />

            <div class="form-group row">
                <div class="col-12">
                    <input asp-for="License.Designer" class="form-control" placeholder="Numer" readonly />
                    <span asp-validation-for="License.Designer" style="font-size:14px" class="text-danger"></span>
                </div>
            </div>

            <div class="form-group row">
                <div class="col-12">
                    <input asp-for="License.Content" class="form-control" placeholder="Numer" />
                    <span asp-validation-for="License.Content" style="font-size:14px" class="text-danger"></span>
                </div>
            </div>

            <div class="form-group">
                @for (int i = 0; i < Model.License.ApplyBranches.Count; i++)
                {
                    <input asp-for="License.ApplyBranches[i].Value" type="hidden" value="License.ApplyBranches[i].Value">
                    <input asp-for="License.ApplyBranches[i].Text" type="hidden" value="License.ApplyBranches[i].Text">
                    <div class="row">
                        <div class="col-1 clickable">
                            <a onclick="RemoveBranch(@Model.License.Id,@Model.License.ApplyBranches[i].Value)"
                               class="text-danger text-right">
                                <i class="fas fa-minus-circle"></i>
                            </a>
                        </div>
                        <div class="col">@Model.License.ApplyBranches[i].Text</div>
                    </div>
                }
            </div>

            <div class="form-group">
                <div class="row align-middle">
                    <div class="col pt-1 pb-1">
                        @Html.DropDownListFor(model => model.License.BranchId, @Model.License.Branches, new { @class = "form-control" })
                        <span asp-validation-for="License.BranchId" style="font-size:14px" class="text-danger"></span>
                    </div>
                    <div class="btn btn-lg col-2 text-success">
                        <a onclick="AddBranch(@Model.License.Id)">
                            <i class="fas fa-plus-circle"></i>
                        </a>
                    </div>
                </div>
            </div>

            <input type="submit" class="btn btn-primary form-control" value="Zapisz i wróć do listy projektantów" />
        </form>
    </div>
</div>


@section Scripts{

    
<script>

function RemoveBranch(licenseId, branchId) {
    $.ajax({
        type: "Delete",
        url: `@Url.Page("Edit", "Branch")&id=${licenseId}&branchId=${branchId}`,
        beforeSend: function (xhr) {
            xhr.setRequestHeader("XSRF-TOKEN",
                $('input:hidden[name="__RequestVerificationToken"]').val());
        },
        success: function (data) {
            console.log(data);
            //window.location.href = `/Licenses/Edit?Id=${licenseId}`;
        }
    })
}

</script>

<script>

    function AddBranch(licenseId) {

        var select = $("#License_BranchId").val();
        $.ajax({
            type: "Put",
            url: `@Url.Page("Edit", "Branch")&id=${licenseId}&branchId=${select}`,
            beforeSend: function (xhr) {
                xhr.setRequestHeader("XSRF-TOKEN",
                    $('input:hidden[name="__RequestVerificationToken"]').val());
            },
            success: function (data) {
                window.location.href = `/Licenses/Edit?Id=${licenseId}`;
            }
        })
    }

</script>
}
